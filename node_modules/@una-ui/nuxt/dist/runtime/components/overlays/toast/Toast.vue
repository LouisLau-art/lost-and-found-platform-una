<script setup>
import { reactivePick } from "@vueuse/core";
import { ToastRoot, useForwardPropsEmits } from "reka-ui";
import { cn } from "../../../utils";
import Icon from "../../elements/Icon.vue";
import Progress from "../../elements/Progress.vue";
import ToastAction from "./ToastAction.vue";
import ToastClose from "./ToastClose.vue";
import ToastDescription from "./ToastDescription.vue";
import ToastInfo from "./ToastInfo.vue";
import ToastTitle from "./ToastTitle.vue";
defineOptions({
  inheritAttrs: false
});
const props = defineProps({
  toast: { type: null, required: false, default: "solid-white" },
  leading: { type: null, required: false },
  title: { type: String, required: false },
  description: { type: String, required: false },
  closable: { type: Boolean, required: false, default: true },
  actions: { type: Array, required: false },
  toasts: { type: Array, required: false },
  size: { type: String, required: false },
  showProgress: { type: Boolean, required: false },
  _toastProvider: { type: Object, required: false },
  _toastTitle: { type: Object, required: false },
  _toastDescription: { type: Object, required: false },
  _toastViewport: { type: Object, required: false },
  _toastAction: { type: Object, required: false },
  _toastClose: { type: Object, required: false },
  _toastInfo: { type: Object, required: false },
  _progress: { type: Object, required: false },
  una: { type: Object, required: false },
  onOpenChange: { type: Function, required: false, skipCheck: true },
  class: { type: null, required: false },
  progress: { type: null, required: false },
  defaultOpen: { type: Boolean, required: false },
  forceMount: { type: Boolean, required: false },
  type: { type: String, required: false },
  open: { type: Boolean, required: false },
  duration: { type: Number, required: false },
  asChild: { type: Boolean, required: false },
  as: { type: null, required: false }
});
const emits = defineEmits(["escapeKeyDown", "pause", "resume", "swipeStart", "swipeMove", "swipeCancel", "swipeEnd", "update:open"]);
const rootProps = useForwardPropsEmits(reactivePick(props, "as", "asChild", "defaultOpen", "open", "duration", "type", "forceMount"), emits);
</script>

<template>
  <ToastRoot
    v-slot="{ remaining, duration }"
    :class="cn(
  'group toast data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--reka-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--reka-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full',
  props.una?.toast,
  props.class
)"
    v-bind="{ ...rootProps, ...$attrs }"
    :toast
    @update:open="onOpenChange"
  >
    <slot name="leading">
      <Icon
        v-if="leading"
        :name="leading"
        :class="cn(
  'toast-leading',
  props.una?.toastLeading
)"
      />
    </slot>

    <div
      :class="cn(
  'toast-wrapper',
  props.una?.toastWrapper
)"
    >
      <slot>
        <ToastInfo
          v-if="$slots.info || $slots.title || $slots.description || title || description"
          v-bind="_toastInfo"
          :una
        >
          <slot name="info">
            <ToastTitle
              v-if="$slots.title || title"
              v-bind="_toastTitle"
              :una
            >
              <slot name="title">
                {{ title }}
              </slot>
            </ToastTitle>

            <ToastDescription
              v-if="$slots.description || description"
              v-bind="_toastDescription"
              :una
            >
              <slot name="description">
                {{ description }}
              </slot>
            </ToastDescription>
          </slot>
        </ToastInfo>

        <div
          v-if="actions"
          class="toast-actions"
        >
          <slot name="actions" :actions>
            <ToastAction
              v-for="(action, index) in actions"
              :key="index"
              v-bind="action"
            />
          </slot>
        </div>

        <ToastClose
          v-if="closable"
          v-bind="_toastClose"
          :una
        >
          <slot name="closeIcon" />
        </ToastClose>
      </slot>
    </div>

    <div
      v-if="showProgress"
      class="absolute inset-x-0 bottom-0 !mx-0"
    >
      <Progress
        :progress
        v-bind="_progress"
        :class="cn(
  'toast-progress bg-transparent',
  props.una?.toastProgress
)"
        :model-value="remaining / duration * 100"
      />
    </div>
  </ToastRoot>
</template>
