<script setup>
import { createReusableTemplate } from "@vueuse/core";
import { SIDEBAR_WIDTH_MOBILE, useSidebar } from "../../composables/useSidebar";
import { cn } from "../../utils";
import Sheet from "../sheet/Sheet.vue";
import SidebarContent from "./SidebarContent.vue";
import SidebarFooter from "./SidebarFooter.vue";
import SidebarHeader from "./SidebarHeader.vue";
defineOptions({
  inheritAttrs: false
});
const props = defineProps({
  sheet: { type: String, required: false, default: "left" },
  sidebar: { type: String, required: false, default: "sidebar" },
  collapsible: { type: String, required: false, default: "offcanvas" },
  class: { type: null, required: false },
  rail: { type: Boolean, required: false, default: true },
  _sheetContent: { type: Object, required: false },
  _sidebarContent: { type: Object, required: false },
  _sidebarHeader: { type: Object, required: false },
  _sidebarFooter: { type: Object, required: false },
  _sidebarRail: { type: Object, required: false },
  una: { type: Object, required: false }
});
const { isMobile, state, openMobile, setOpenMobile } = useSidebar();
const [DefineSlot, ReuseSlot] = createReusableTemplate();
</script>

<template>
  <DefineSlot>
    <slot>
      <SidebarHeader v-bind="props._sidebarHeader">
        <slot name="header" />
      </SidebarHeader>
      <SidebarContent v-bind="props._sidebarContent">
        <slot name="content" />
      </SidebarContent>
      <SidebarFooter v-bind="props._sidebarFooter">
        <slot name="footer" />
      </SidebarFooter>
      <NSidebarRail v-if="rail" v-bind="props._sidebarRail" />
    </slot>
  </DefineSlot>

  <div
    v-if="collapsible === 'none'"
    data-slot="sidebar"
    :class="cn(
  'sidebar-collapsible-none',
  props.una?.sidebar,
  props.class
)"
    v-bind="$attrs"
  >
    <ReuseSlot />
  </div>

  <Sheet
    v-else-if="isMobile"
    :open="openMobile"
    v-bind="$attrs"
    :_sheet-content="{
  dataSlot: 'sidebar',
  dataSidebar: 'sidebar',
  dataMobile: true,
  sheet,
  class: 'sidebar-mobile',
  style: {
    '--sidebar-width': SIDEBAR_WIDTH_MOBILE
  },
  ...props._sheetContent
}"
    @update:open="setOpenMobile"
  >
    <template #body>
      <div class="sidebar-mobile-inner">
        <ReuseSlot />
      </div>
    </template>
  </Sheet>

  <div
    v-else :class="cn('group peer sidebar-desktop')"
    data-slot="sidebar"
    :data-state="state"
    :data-collapsible="state === 'collapsed' ? collapsible : ''"
    :data-variant="sidebar"
    :data-side="sheet"
  >
    <!-- This is what handles the sidebar gap on desktop  -->
    <div
      :class="cn(
  'sidebar-desktop-gap',
  sidebar === 'floating' || sidebar === 'inset' ? 'sidebar-desktop-gap-floating' : 'sidebar-desktop-gap-default'
)"
    />
    <div
      :class="cn(
  'sidebar-desktop-position',
  sheet === 'left' ? 'sidebar-desktop-position-left' : 'sidebar-desktop-position-right',
  // Adjust the padding for floating and inset variants.
  sidebar === 'floating' || sidebar === 'inset' ? 'sidebar-desktop-padding-floating' : 'sidebar-desktop-padding-default',
  props.una?.sidebar,
  props.class
)"
      v-bind="$attrs"
    >
      <div
        data-sidebar="sidebar"
        class="sidebar-desktop-inner"
      >
        <ReuseSlot />
      </div>
    </div>
  </div>
</template>
