<script setup>
import { createReusableTemplate } from "@vueuse/core";
import { computed } from "vue";
import { cn } from "../../utils";
import NIcon from "../elements/Icon.vue";
import NLink from "../elements/Link.vue";
const props = defineProps({
  type: { type: String, required: false, default: "button" },
  loadingPlacement: { type: String, required: false, default: "leading" },
  icon: { type: Boolean, required: false },
  disabled: { type: Boolean, required: false },
  reverse: { type: Boolean, required: false },
  loading: { type: Boolean, required: false },
  block: { type: Boolean, required: false },
  to: { type: null, required: false },
  label: { type: String, required: false },
  btn: { type: String, required: false },
  leading: { type: String, required: false },
  trailing: { type: String, required: false },
  size: { type: String, required: false, default: "sm" },
  una: { type: Object, required: false, default: () => ({
    btnDefaultVariant: "btn-default-variant"
  }) },
  square: { type: null, required: false },
  rounded: { type: null, required: false, default: "md" },
  class: { type: null, required: false },
  breadcrumbActive: { type: String, required: false },
  breadcrumbInactive: { type: String, required: false },
  paginationSelected: { type: String, required: false },
  paginationUnselected: { type: String, required: false },
  dropdownMenu: { type: String, required: false },
  toggleOn: { type: String, required: false },
  toggleOff: { type: String, required: false },
  tabsActive: { type: String, required: false },
  tabsInactive: { type: String, required: false },
  navigationMenu: { type: String, required: false },
  navigationMenuLink: { type: String, required: false },
  ariaLabel: { type: String, required: false }
});
const mergeVariants = computed(() => {
  return {
    "btn": props.btn,
    "breadcrumb-active": props.breadcrumbActive,
    "breadcrumb-inactive": props.breadcrumbInactive,
    "pagination-selected": props.paginationSelected,
    "pagination-unselected": props.paginationUnselected,
    "dropdown-menu": props.dropdownMenu,
    "toggle-on": props.toggleOn,
    "toggle-off": props.toggleOff,
    "tabs-active": props.tabsActive,
    "tabs-inactive": props.tabsInactive,
    "navigation-menu": props.navigationMenu,
    "navigation-menu-link": props.navigationMenuLink
  };
});
const loadingPlacement = computed(() => props.loadingPlacement === "leading" && props.icon ? "label" : props.loadingPlacement);
const btnVariants = ["solid", "outline", "soft", "ghost", "link", "text"];
const hasVariant = computed(
  () => Object.values(mergeVariants.value).some(
    (variantList) => btnVariants.some((variant) => variantList?.includes(variant))
  )
);
const isBaseVariant = computed(
  () => Object.values(mergeVariants.value).some(
    (variantList) => variantList?.includes("~")
  )
);
const square = computed(() => props.square ?? !!props.icon);
const [DefineTemplate, ReuseTemplate] = createReusableTemplate();
</script>

<template>
  <Component
    :is="to ? NLink : 'button'"
    :to="to"
    :type="to ? null : type"
    :class="cn(
  (square === '' || square) && 'btn-square',
  block && 'btn-block',
  !hasVariant && !isBaseVariant ? una?.btnDefaultVariant : null,
  reverse && 'btn-reverse',
  'btn',
  una?.btn,
  props.class
)"
    :disabled="disabled || loading"
    :aria-label="props.ariaLabel ? props.ariaLabel : props.icon ? props.label : void 0"
    :rounded
    :size
    :square
    v-bind="mergeVariants"
  >
    <DefineTemplate v-if="loading">
      <slot name="loading">
        <NIcon
          :name="una?.btnLoadingIcon ?? 'btn-loading-icon'"
          :class="una?.btnLoading"
          btn="loading"
        />
      </slot>
    </DefineTemplate>

    <ReuseTemplate v-if="loading && loadingPlacement === 'leading'" />
    <slot
      v-else
      name="leading"
    >
      <NIcon
        v-if="leading"
        :name="leading"
        :class="cn(
  'btn-leading',
  una?.btnLeading
)"
      />
    </slot>

    <ReuseTemplate v-if="loading && loadingPlacement === 'label'" />
    <slot v-else>
      <NIcon
        v-if="label && icon"
        :name="label"
        btn="icon-label"
        :class="una?.btnIconLabel"
      />
      <span
        v-if="!icon"
        btn="label"
        :class="una?.btnLabel"
      >
        {{ label }}
      </span>
    </slot>

    <ReuseTemplate v-if="loading && loadingPlacement === 'trailing'" />
    <slot
      v-else
      name="trailing"
    >
      <NIcon
        v-if="trailing"
        :name="trailing"
        btn="trailing"
        :class="una?.btnTrailing"
      />
    </slot>
  </Component>
</template>
